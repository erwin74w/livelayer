<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Stream Overlay</title>
    <style>
        html, body {
            background-color: transparent !important;
            margin: 0;
            padding: 0;
            width: 100%;
            height: 100%;
            overflow: hidden;
        }
        iframe {
            display: block; /* Default to block, will be changed by JS */
            width: 100%;
            height: 100%;
            border: none;
            background-color: transparent;
        }
        .hidden {
            display: none !important; /* Ensure it's hidden */
        }
    </style>
</head>
<body>
    <iframe
        id="overlayFrame"
        src="overlay1/overlay1.html"
        allowtransparency="true"
        scrolling="no"
        frameborder="0"
    ></iframe>

    <script>
        const overlayFrame = document.getElementById('overlayFrame');
        const overlayStateKey = 'overlay1Visibility'; // Same key as in console.html

        function applyVisibility(state) {
            if (state === 'show') {
                overlayFrame.classList.remove('hidden');
            } else { // 'hide' or any other value defaults to hidden
                overlayFrame.classList.add('hidden');
            }
        }

        // 1. Check localStorage on initial load
        const initialState = localStorage.getItem(overlayStateKey);
        if (initialState) {
            applyVisibility(initialState);
        } else {
            // Default state if nothing is in localStorage (e.g., first time)
            applyVisibility('hide'); // Or 'show' if you want it visible by default
            localStorage.setItem(overlayStateKey, 'hide'); // Set default in storage
            localStorage.setItem(overlayStateKey + 'Timestamp', Date.now());
        }

        // 2. Listen for changes from console.html
        window.addEventListener('storage', (event) => {
            // Check if the key is the one we care about (overlayStateKey or its timestamp)
            // We mainly react to changes in overlayStateKey itself.
            if (event.key === overlayStateKey) {
                if (event.newValue) {
                    applyVisibility(event.newValue);
                } else {
                    // Key was removed or set to null, treat as hidden
                    applyVisibility('hide');
                }
            }
        });
    </script>
</body>
</html>
