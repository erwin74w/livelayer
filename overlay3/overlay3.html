<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lower Third Overlay (Supabase)</title>
    <link rel="stylesheet" href="overlay3.css">
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</head>
<body>
    <div id="lowerThirdContainer" class="lower-third-container">
        <div id="ltName" class="lt-name"></div>
        <div id="ltFunction" class="lt-function"></div>
        <div id="ltAffiliation" class="lt-affiliation"></div>
    </div>

    <script>
        const SUPABASE_URL = 'YOUR_SUPABASE_URL'; // Replace
        const SUPABASE_ANON_KEY = 'YOUR_SUPABASE_ANON_KEY'; // Replace

        const nameEl = document.getElementById('ltName');
        const functionEl = document.getElementById('ltFunction');
        const affiliationEl = document.getElementById('ltAffiliation');
        const containerEl = document.getElementById('lowerThirdContainer');
        const defaultLowerThirdData = { name: "N/A", function: "", affiliation: ""};

        function updateLowerThirdContent(data) {
            if (data) {
                nameEl.textContent = data.name || '';
                functionEl.textContent = data.function || '';
                affiliationEl.textContent = data.affiliation || '';
                containerEl.classList.remove('empty');
                functionEl.style.display = data.function ? 'block' : 'none';
                affiliationEl.style.display = data.affiliation ? 'block' : 'none';
            } else {
                nameEl.textContent = defaultLowerThirdData.name;
                functionEl.textContent = defaultLowerThirdData.function;
                affiliationEl.textContent = defaultLowerThirdData.affiliation;
                containerEl.classList.add('empty');
            }
        }

        async function loadContent() {
            if (SUPABASE_URL === 'YOUR_SUPABASE_URL' || !supabase) {
                console.warn("Supabase not configured for lower third, using default.");
                updateLowerThirdContent(defaultLowerThirdData);
                return;
            }
            const { createClient } = supabase;
            const supabaseClient = createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

            const { data, error } = await supabaseClient
                .from('overlay_configurations')
                .select('config_data')
                .eq('overlay_type', 'lower_third')
                .single();

            if (error && error.code !== 'PGRST116') {
                console.error("Error loading lower third data from Supabase:", error);
                updateLowerThirdContent(null); // Show placeholder on error
            } else if (data && data.config_data) {
                updateLowerThirdContent(data.config_data);
            } else {
                console.log("No lower third data in Supabase, using default.");
                updateLowerThirdContent(defaultLowerThirdData);
            }
        }
        loadContent();

        // FOR REAL-TIME UPDATES (Advanced - MVP+):
        /*
        if (supabaseClient) {
             const channel = supabaseClient
                .channel('lower-third-updates')
                .on('postgres_changes', { event: '*', schema: 'public', table: 'overlay_configurations', filter: 'overlay_type=eq.lower_third' }, payload => {
                    console.log('Lower Third config change received!', payload);
                    if (payload.new && payload.new.config_data) {
                        updateLowerThirdContent(payload.new.config_data);
                    } else {
                         updateLowerThirdContent(defaultLowerThirdData);
                    }
                })
                .subscribe();
        }
        */
    </script>
</body>
</html>
